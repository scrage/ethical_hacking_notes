#redis #databases #vulnerability-assessment #anonymous-access #reconnaissance 

# 0. Theory

**Redis** is an 'in-memory' database. Inmemory databases are the ones that rely essentially on the primary memory for data storage (meaning that the database is managed in the RAM of the system); in contrast to databases that store data on the disk or SSDs. As the primary memory is significantly faster than the secondary memory, the data retrieval time in the case of 'in-memory' databases is very small, thus offering very efficient & minimal response times.

In-memory databases like Redis are typically used to cache data that is frequently requested for quick retrieval.


**Which TCP port is open on the machine?**
*6379*

**Which service is running on the port that is open on the machine?**
*redis*

**What type of database is Redis?**
*In-memory Database*

**Which command-line utility is used to interact with the Redis server?**
*redis-cli*

**Which flag is used with the Redis command-line utility to specify the hostname?**
*-h*

**Once connected to a Redis server, which command is used to obtain the information and statistics about the Redis server?**
*info*

**Which command is used to select the desired database in Redis?**
*select*

**Which command is used to obtain all the keys in a database?**
`keys *`

# 1. Recon

Verifying target IP:

	┌─[eu-starting-point-vip-1-dhcp]─[10.10.14.26]─[scrage@htb-v2cvbixxdl]─[~]
	└──╼ [★]$ ping 10.129.255.224 -c 5
	PING 10.129.255.224 (10.129.255.224) 56(84) bytes of data.
	64 bytes from 10.129.255.224: icmp_seq=1 ttl=63 time=8.71 ms
	64 bytes from 10.129.255.224: icmp_seq=2 ttl=63 time=7.91 ms
	64 bytes from 10.129.255.224: icmp_seq=3 ttl=63 time=8.61 ms
	64 bytes from 10.129.255.224: icmp_seq=4 ttl=63 time=8.07 ms
	64 bytes from 10.129.255.224: icmp_seq=5 ttl=63 time=8.28 ms
	
	--- 10.129.255.224 ping statistics ---
	5 packets transmitted, 5 received, 0% packet loss, time 4003ms
	rtt min/avg/max/mdev = 7.914/8.317/8.713/0.305 ms


# 2. Enumeration

Scanning for open ports and services:

	┌─[eu-starting-point-vip-1-dhcp]─[10.10.14.26]─[scrage@htb-v2cvbixxdl]─[~]
	└──╼ [★]$ sudo nmap -sV 10.129.255.224
	Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-08-27 11:15 CDT
	Nmap scan report for 10.129.255.224
	Host is up (0.0093s latency).
	All 1000 scanned ports on 10.129.255.224 are in ignored states.
	Not shown: 1000 closed tcp ports (reset)
	
	Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
	Nmap done: 1 IP address (1 host up) scanned in 0.51 seconds
	┌─[eu-starting-point-vip-1-dhcp]─[10.10.14.26]─[scrage@htb-v2cvbixxdl]─[~]
	└──╼ [★]$ nmap -p- -sV 10.129.255.224
	Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-08-27 11:15 CDT
	Nmap scan report for 10.129.255.224
	Host is up (0.0098s latency).
	Not shown: 65534 closed tcp ports (reset)
	PORT     STATE SERVICE VERSION
	6379/tcp open  redis   Redis key-value store 5.0.7
	
	Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
	Nmap done: 1 IP address (1 host up) scanned in 14.75 seconds

We can see that port **6379** is open and it is running a Redis server.

**Redis** (**RE**mote **DI**ctionary **S**erver) is an open-source advanced NoSQL key-value data store used as a database, cache, and message broker. The data is stored in a dictionary format having key-value pairs. It is typically used for short term storage of data that needs fast retrieval. Redis does backup data to hard drives to provide consistency.

Redis runs as server-side software so its core functionality is in its server component. The server listens for connections from clients, programmatically or through the command-line interface.

The database is stored in the server's RAM to enable fast data access. Redis also writes the contents of the database to disk at varying intervals to persist it as a backup, in case of failure.

In order to enumerate the target host's Redis server, first we need to install `redis-cli` with the command `sudo apt install redis-tools`.

	┌─[eu-starting-point-vip-1-dhcp]─[10.10.14.26]─[scrage@htb-v2cvbixxdl]─[~]
	└──╼ [★]$ sudo apt install redis-tools
	Reading package lists... Done
	Building dependency tree... Done
	Reading state information... Done
	redis-tools is already the newest version (5:7.0.15-1~deb12u1).
	The following packages were automatically installed and are no longer required:
	  espeak-ng-data geany-common libamd2 libbabl-0.1-0 libbrlapi0.8 libcamd2
	  libccolamd2 libcholmod3 libdotconf0 libept1.6.0 libespeak-ng1 libgegl-0.4-0
	  libgegl-common libgimp2.0 libmetis5 libmng1 libmypaint-1.5-1
	  libmypaint-common libpcaudio0 libsonic0 libspeechd2 libtorrent-rasterbar2.0
	  libumfpack5 libwmf-0.2-7 libwpe-1.0-1 libwpebackend-fdo-1.0-1 libxapian30
	  node-clipboard node-prismjs python3-brlapi python3-louis python3-pyatspi
	  python3-speechd sound-icons speech-dispatcher-audio-plugins xbrlapi xkbset
	Use 'sudo apt autoremove' to remove them.
	0 upgraded, 0 newly installed, 0 to remove and 156 not upgraded.

After checking the `redis-cli --help` command, we find the `-h` switch that we need to use in order to specify the host we want to connect to.

	-h : specify the hostname of the target to connect to

And since we know the target host's IP address, we can connect to the Redis server that is running on it:

	┌─[eu-starting-point-vip-1-dhcp]─[10.10.14.26]─[scrage@htb-v2cvbixxdl]─[~]
	└──╼ [★]$ redis-cli -h 10.129.255.224
	10.129.255.224:6379> 

One of the basic Redis enumeration commands is `info` which returns information and statistics about the Redis server. The output is relatively long, but there is information in there about the server in use, and the **Keyspace** section provides statistics on the main dictionary of each database. The statistics include the number of keys, and the number of keys with an expiration.

	10.129.255.224:6379> info
	# Server
	redis_version:5.0.7
	redis_git_sha1:00000000
	redis_git_dirty:0
	redis_build_id:66bd629f924ac924
	
	[** SNIPPED IRRELEVANT INFO **]
	
	# Keyspace
	db0:keys=4,expires=0,avg_ttl=0

We can see here that only one database exists, with index 0.
Let's select this Redis logical DB by using the `select` command followed by the index number of the database that needs to be selected.

	10.129.255.224:6379> select 0
	OK

Furthermore, we can list all the keys present in the database using the `keys *` command.

	10.129.255.224:6379> keys *
	1) "temp"
	2) "flag"
	3) "stor"
	4) "numb"

Finally, we can view the values stored for a corresponding key using the `get` command followed by the keynote.

	10.129.255.224:6379> get temp
	"1c98492cd337252698d0c5f631dfb7ae"
	10.129.255.224:6379> get stor
	"e80d635f95686148284526e1980740f8"
	10.129.255.224:6379> get numb
	"bb2c8a7506ee45cc981eb88bb81dddab"
	10.129.255.224:6379> get flag
	"03e1d2b376c37ab3f5319922053953eb"


https://www.hackthebox.com/achievement/machine/2057492/472
![[Pasted image 20240827184049.png]]